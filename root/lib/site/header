[% # -*- mode: web; mode: follow; -*- %]
<!-- BEGIN site/header -->
<header>
  <nav class="navbar navbar-dark bg-dark" id="header">
    [% IF c.user_exists && c.session.auth_uid # !!! to fix, looks like a stub %]
    <a id="sidebarCollapse" class="navbar-toggler btn btn-link p-0 pr-3" href="#" title="show/hide left panel">
      <i id="sidebarLeftToggler" class="fas fa-fw [% toggle_a %][% # defined in layout %]"></i>
    </a>
    [% END %]

    <a id="navbarbrand" class="navbar-brand" href="/">
      <img src="/static/images/umi-logo.50x50.png" width="30" height="30" alt="logo">
    </a>

    [% IF c.user_exists && c.check_any_user_role ('admin', 'coadmin', 'operator') %]

    <div class="col">
      <form class="form-inline formajaxer justify-content-center"
	    role="form"
	    id="searchby"
	    method="POST"
	    action="/searchby">

	<div class="input-group col-10">
	  <input type="text"
		 class="form-control text-monospace"
		 id="ldapsearch_filter"
		 name="ldapsearch_filter"
		 placeholder='attributeName=*value*'
		 title="
&bull; default sort criteria is by name (First/Last Name, uid and cn)
&bull; for each search criteria, objectClass=* is used if empty
&bull; use * as substring
&bull; narrow search results for non &laquo;by ...&raquo; presets, by providing attribute in filter, like: uid=*dreii.*
&bull; to search in access log, use base [% helper_cfg('cfg_local','ldap_crud_db_log') %]"
		 data-animation="false"
		 data-toggle="popover"
		 data-trigger="hover"
		 data-placement="bottom"
		 data-html="true"
		 data-content="<ul>
		 <li>default sort criteria is <i class='text-info'>by name</i> (First/Last Name, uid and cn)</li>
		 <li>for each search criteria, <i class='text-info'>objectClass=<i class='fa fa-asterisk'></i></i> is used if empty</li>
		 <li>use <i class='fa fa-asterisk text-info'></i> as substring</li>
		 <li>narrow search results for non &laquo;by ...&raquo; presets, by providing attribute in filter, like: <i class='text-info'>uid=<i class='fa fa-asterisk'></i>dreii.<i class='fa fa-asterisk'></i></i></li>
		 <li>to search in access log, use base <i class='text-info'>[% helper_cfg('cfg_local','ldap_crud_db_log') %]</i></li>
		 </ul>">

	  <input type="hidden" name="ldap_base_case" id="ldap_base_case" >
	  
	  <div class="input-group-append">
	    <button type="submit"
		    class="btn btn-secondary"
		    onClick="document.getElementById('ldap_base_case').value=this.value"
                    value="ldapsearch_by_name" tabindex="13"
                    title="Search &laquo;by name&raquo;">
              <i class="fas fa-search"></i>
            </button>
	    
	    <div type="submit" 
		 class="btn btn-secondary dropdown-toggle"
		 data-toggle="dropdown" 
		 aria-haspopup="true" 
		 aria-expanded="false">
	      <i class="sr-only">Toggle Dropdown</i>
	    </div>

	    [% icon_class = "fas fa-fw text-success" %]
	    [% menu_item = "dropdown-item btn btn-link umi-font-bold " %]
	    [% color = "text-success" %]

	    <div class="dropdown-menu dropdown-menu-right">

	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_name"
		      title="filter pattern in givenName or sn or uid or cn">
		<i class="[% icon_class %] fa-user"></i> by name
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_email"
		      title="filter pattern in mail">
		<i class="[% icon_class %] fa-envelope"></i> by mail
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_jid"
		      title="filter pattern in mail">
		<i class="[% icon_class %] fa-lightbulb"></i> by JID
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_ip"
		      title="filter pattern in ip address">
		<i class="[% icon_class %] fa-network-wired"></i> by IP
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_mac"
		      title="filter pattern in MAC address">
		<i class="[% icon_class %] fa-barcode"></i> by MAC
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_sn"
		      title="filter pattern in Serial Number address">
		<i class="[% icon_class %] fa-qrcode"></i> by S/N
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_by_telephone"
		      title="filter pattern in telephone number">
		<i class="[% icon_class %] fa-phone"></i> by tel num
	      </button>
	      <button type="submit" class="[% menu_item %] text-dark"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="ldapsearch_global"
		      title="global search through all DB, by attrName=*value*">
		<i class="fas fa-fw fa-database text-dark"></i> GLOBAL
	      </button>
	      
	      [% icon_class = "fas fa-fw text-info" %]
	      [% color = "text-info" %]

	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'group') %]"
		      title="filter pattern with base Groups">
		<i class="[% icon_class %] fa-users"></i> group
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'netgroup') %]"
		      title="filter pattern with base NisNetgroups">
		<i class="[% icon_class %] fa-user-friends"></i> netgroup
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      name="ldapsearch_base"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'acc_root') %]"
		      title="filter pattern with base People">
		<i class="[% icon_class %] fa-user"></i> people
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'org') %]"
		      tabindex="20"
		      title="filter pattern with base Organizations">
		<i class="[% icon_class %] fa-building"></i> organization
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'dhcp') %]"
		      tabindex="21"
		      title="filter pattern with base DHCP">
		<i class="[% icon_class %] fa-network-wired"></i> DHCP
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      tabindex="22"
		      title="filter pattern with base Aliases">
		<i class="[% icon_class %] fa-file-alt"></i> alias
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'workstations') %]"
		      tabindex="23"
		      title="filter pattern with base Workstations">
		<i class="[% icon_class %] fa-desktop"></i> workstations
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'machines') %]"
		      tabindex="24"
		      title="filter pattern with base Machines">
		<i class="[% icon_class %] fa-server"></i> machines
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'inventory') %]"
		      tabindex="24"
		      title="filter pattern with base Inventory">
		<i class="[% icon_class %] fa-pen-nib"></i> inventory
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'mta') %]"
		      tabindex="24"
		      title="filter pattern with base Sendmail">
		<i class="[% icon_class %] fa-envelope"></i> sendmail
	      </button>
	      <button type="submit" class="[% menu_item %][% color %]"
		      onClick="document.getElementById('ldap_base_case').value=this.value"
		      value="[% helper_cfg('cfg_ldap_crud','base', 'gitacl') %]"
		      tabindex="25">
		<i class="fab fa-fw text-info fa-git"></i> GitACL
	      </button>
	    </div>
	    <a href="/searchadvanced"
	       class="btn btn-secondary"
	       title="advanced search">
	      <i class="fa fa-search-plus"></i>
	    </a>
	  </div>
	</div>
      </form>
    </div>

    [% END %]
    [% # -------------------------------------------------------- %]

    <ul class="nav mr-auto">
      [% IF c.user %]
      [%   IF c.check_any_user_role ('admin', 'coadmin', 'operator') %]
      [%     IF navbar_note.size %][% # @ Root->end %]
      <li class="nav-item dropdown">
	<a class="nav-link text-white-50" data-toggle="dropdown" href="#">
	  <i class="fas fa-sticky-note content-plus-circle"></i>
	  <!-- small><span class="badge badge-pill badge-danger bg-danger">[% navbar_note.size %]</span></small -->
	</a>
	<div class="dropdown-menu dropdown-menu-right">
	  <div class="dropdown-header text-center text-dark">
	    <strong>You have [% navbar_note.size %] notification</strong>
	  </div>
	  [% FOREACH note IN navbar_note %]
	  <a href="#" class="dropdown-item">
	    <i class="fa [% note.icon %] text-[% note.color %]"></i> [% note.note %]
	  </a>
	  [% END %]
	</div>
      </li>
      [%     ELSE %]
      <li class="nav-item">
	<div class="nav-link">
	  <i class="fas fa-sticky-note"></i>
	</div>
      </li>
      [%     END %]
      [%   END %]
      <li class="nav-item dropdown">
	<a class="nav-link dropdown-toggle text-white-50" data-toggle="dropdown" href="#"><i class="fa fa-user-alt"></i> [% c.user() %]</a>
	<div class="dropdown-menu dropdown-menu-right">
	  <a class="dropdown-item" href="/user_prefs"><i class="fas fa-cogs"></i>
	    My Profile
	  </a>
	  <a class="dropdown-item ajaxless" href="/auth/signout" title="Sign Out"><i class="fas fa-sign-out-alt"></i>
	    Sign Out
	  </a>
	</div>
      </li>
      [% ELSE %]
      <li class="nav-item">
	<a href="/auth/signin" class="ajaxless" title="Sign In"><i class="fas fa-sign-in-alt"></i></a>
      </li>
      [% END %]
    </ul>
    <a id="sidebarRightCollapse" class="navbar-toggler btn btn-link p-0" href="#" title="show/hide right panel">
      <i id="sidebarRightToggler" class="fas fa-fw [% toggle_a %][% # defined in layout %]"></i>
    </a>
  </nav>
</header>

<script type="text/javascript">
// $(function () { $('#ldapsearch_filter').popover() });
// $(function () { $('#ldapsearch_filter').tooltip() });
// $(function () { $('[data-toggle="tooltip"]').tooltip() });
</script>

<!-- END site/header -->
